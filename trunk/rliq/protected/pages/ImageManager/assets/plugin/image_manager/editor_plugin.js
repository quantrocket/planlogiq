(function(){tinymce.PluginManager.requireLangPack('image_manager');tinymce.create('tinymce.plugins.ExamplePlugin',{init:function(ed,url){ed.addCommand('mceImageManager',function(){ed.windowManager.open({file:ed.getParam('image_manager_url','../../plugins/image_manager/popup.htm'),width:640+parseInt(ed.getLang('image_manager.delta_width',0)),height:420+parseInt(ed.getLang('image_manager.delta_height',0)),inline:1},{plugin_url:url,some_custom_arg:'custom arg'})});ed.addButton('image_manager',{title:'image_manager.desc',cmd:'mceImageManager',image:url+'/img/pictures.gif'});ed.onNodeChange.add(function(ed,cm,n){cm.setActive('image_manager',n.nodeName=='IMG')})},getInfo:function(){return{longname:'Advanced image with Image Manager',author:'Wei Zhuo',authorurl:'http://xlab6.com',infourl:'http://xlab6.com',version:tinymce.majorVersion+"."+tinymce.minorVersion}},execCommand:function(command,user_interface,value){switch(command){case"mceImageManagerInsertImage":if(typeof(value)=="string"&&value.length>0){var inst=tinyMCE.activeEditor;inst.execCommand('mceInsertContent',false,value)}return true}return false},monitorImages:function(){var doc=tinyMCE.selectedInstance.getDoc();var imgs=doc.getElementsByTagName("img"),src,i;for(i=0;i<imgs.length;i++){var alt=tinyMCE.getAttrib(imgs[i],'alt');if(alt.indexOf('IMG://')>-1)this.updateImage(imgs[i],doc,alt.substring(6))}},updateImage:function(img,doc,url){var atitle='',imgtitle=img.title;img.alt=img.title;img.src=url;if(img.parentNode&&img.parentNode){var wrap=img.parentNode.parentNode;atitle=wrap.title}if(atitle==imgtitle){var newImg=doc.createElement("img");newImg.title=img.title;newImg.src=url;newImg.alt=img.title;var rng=doc.createRange();rng.selectNode(wrap);rng.deleteContents();rng.insertNode(newImg);var as=doc.getElementsByTagName("a"),i;for(i=0;i<as.length;i++){if(as[i].title==imgtitle);{rng=document.createRange();rng.selectNode(as[i]);rng.deleteContents()}}}},handleEvent:function(e){if(e.type=='dragdrop'||e.type=='drop'){var self=this;setTimeout(function(){self.monitorImages()},50)}return true}});tinymce.PluginManager.add('image_manager',tinymce.plugins.ExamplePlugin)})();